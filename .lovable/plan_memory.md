# üß† Plan: Hydra Memory ‚Äî RAG Management Hub

> –†–∞–±–æ—á–∏–π –ø–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è —Ä–∞–∑–¥–µ–ª–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –ò–ò-–ì–∏–¥—Ä—ã.  
> –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ –∏—Ç–æ–≥–∞–º –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

---

## üìã –†–µ–∑—é–º–µ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É RAG (–∞–Ω–∞–ª–∏–∑ Lovable)

*–ò–∑—É—á–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö —Ä–∞–±–æ—Ç—ã —Å RAG –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏. –ù–∏–∂–µ ‚Äî –æ—Ü–µ–Ω–∫–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ì–∏–¥—Ä—ã.*

### ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –ì–∏–¥—Ä–µ

| –ú–µ—Ç–æ–¥ | –ì–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
|-------|---------------|
| **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (pgvector)** | `search_session_memory`, `search_role_memory`, `search_role_knowledge` ‚Äî RPC-—Ñ—É–Ω–∫—Ü–∏–∏ —Å cosine similarity |
| **–¢—Ä–∏ —É—Ä–æ–≤–Ω—è –ø–∞–º—è—Ç–∏** | `session_memory` (—Ç–∞–∫—Ç–∏–∫–∞), `role_memory` (–æ–ø—ã—Ç), `role_knowledge` (–∑–Ω–∞–Ω–∏—è) |
| **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** | `SessionMemoryDialog` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ text/semantic, UI —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º —Å—Ö–æ–∂–µ—Å—Ç–∏ |
| **Confidence score** | `role_memory.confidence_score` ‚Äî –æ—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –æ–ø—ã—Ç–∞ |
| **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è** | –ß–∞–Ω–∫–∏ –ø–∞–º—è—Ç–∏ —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `streamContext` –ø—Ä–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–º —Å—Ç—Ä–∏–º–∏–Ω–≥–µ |
| **Agentic RAG** | –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å (`archivist`) ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–æ–ª—å-–∞–≥–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é |
| **Chunking** | `chunk_index`, `chunk_total` –≤ `role_knowledge` ‚Äî —Ä–∞–∑–±–∏–≤–∫–∞ –∑–Ω–∞–Ω–∏–π –Ω–∞ —á–∞—Å—Ç–∏ |
| **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** | –ü–æ–ª—è `tags`, `source_title`, `source_url`, `version` –≤ `role_knowledge` |
| **Context Compression** | –¢–æ–ª—å–∫–æ —Ç–æ–ø-N —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ similarity –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–æ–¥–µ–ª–∏ |

### üö´ –ù–µ –Ω—É–∂–Ω–æ –ì–∏–¥—Ä–µ

| –ú–µ—Ç–æ–¥ | –ü–æ—á–µ–º—É |
|-------|--------|
| **LangChain / LlamaIndex** | –ì–∏–¥—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –Ω–∞ Supabase + edge functions. –§—Ä–µ–π–º–≤–æ—Ä–∫–∏ –¥–æ–±–∞–≤—è—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±–µ–∑ –≤—ã–≥–æ–¥—ã |
| **ColBERT** | –¢—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (GPU). –î–ª—è –∑–∞–¥–∞—á –ì–∏–¥—Ä—ã pgvector –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ |
| **Self-RAG** | –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç self-critique loop —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ LLM-–≤—ã–∑–æ–≤–∞–º–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å. –î–æ—Ä–æ–≥–æ, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ —Å–ª–æ–∂–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–∞—Å—à—Ç–∞–±–∞ |
| **RAPTOR** | –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤—å–µ–≤ ‚Äî –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π |

### üí° –ì–∏–¥—Ä–∞ –¥–µ–ª–∞–µ—Ç –ª—É—á—à–µ, —á–µ–º –æ–ø–∏—Å–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ

| –ö–æ–Ω—Ü–µ–ø—Ü–∏—è | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –ì–∏–¥—Ä–µ |
|-----------|-------------------|
| **Agentic RAG** | –ù–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É ‚Äî –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è —Ä–æ–ª—å –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º, –æ–ø—ã—Ç–æ–º –∏ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π. –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —á–∞—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ |
| **Memory Layers** | –¢—Ä–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è (—Å–µ—Å—Å–∏—è / –æ–ø—ã—Ç / –∑–Ω–∞–Ω–∏—è) –≤–º–µ—Å—Ç–æ –ø–ª–æ—Å–∫–æ–≥–æ –µ–¥–∏–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ |
| **Context Compression** | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ `p_limit` –≤ RPC-—Ñ—É–Ω–∫—Ü–∏—è—Ö |

### üöÄ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–∑–∞–¥–µ–ª –Ω–∞ –±—É–¥—É—â–µ–µ)

| –ú–µ—Ç–æ–¥ | –¶–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –ì–∏–¥—Ä—ã | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-------|-------------------|-----------|
| **Hybrid Search (BM25 + vector)** | –¢–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∞–º –º–æ–¥–µ–ª–µ–π, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º —Ç–µ—Ä–º–∏–Ω–∞–º, –∫–æ–¥–æ–≤—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º | üî¥ –í—ã—Å–æ–∫–∏–π |
| **Reranking (Cross-encoder)** | –ü–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ —Ç–æ–ø-20 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ—Å–ª–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞. –£–ª—É—á—à–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –¥–ª—è –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞ | üî¥ –í—ã—Å–æ–∫–∏–π |
| **HyDE (Hypothetical Document Embeddings)** | –ü–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –∏ –∏—Å–∫–∞—Ç—å –ø–æ –Ω–µ–º—É. –û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è role_knowledge | üü° –°—Ä–µ–¥–Ω–∏–π |
| **Parent-Document Retrieval** | –•—Ä–∞–Ω–∏—Ç—å –º–µ–ª–∫–∏–µ —á–∞–Ω–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –£–ª—É—á—à–∞–µ—Ç —Å–≤—è–∑–Ω–æ—Å—Ç—å | üü° –°—Ä–µ–¥–Ω–∏–π |
| **Lost in the Middle mitigation** | –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤: –≤–∞–∂–Ω—ã–µ ‚Äî –≤ –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –ø—Ä–æ–º–ø—Ç–∞, –∞ –Ω–µ –≤ —Å–µ—Ä–µ–¥–∏–Ω—É | üü° –°—Ä–µ–¥–Ω–∏–π |
| **Adaptive Chunking** | –†–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —á–∞–Ω–∫–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∫–æ–¥ vs. —Ç–µ–∫—Å—Ç vs. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏) | üü¢ –ù–∏–∑–∫–∏–π |
| **Memory Graph (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)** | –ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Å–ª–æ—è–º–∏ –ø–∞–º—è—Ç–∏. –ö—Ä–∞—Å–∏–≤–æ, –Ω–æ –Ω–µ —Å—Ä–æ—á–Ω–æ | üü¢ –ù–∏–∑–∫–∏–π |

---

## üì¶ –ò—Ç–µ—Ä–∞—Ü–∏—è 1 ‚Äî –§—É–Ω–¥–∞–º–µ–Ω—Ç (–í–´–ü–û–õ–ù–ï–ù–û ‚úÖ)

**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| `src/pages/HydraMemory.tsx` | ‚úÖ | –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç—Ä–µ–º—è –≤–∫–ª–∞–¥–∫–∞–º–∏ |
| `src/hooks/useHydraMemoryStats.ts` | ‚úÖ | –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ –≤—Å–µ—Ö —Ç—Ä—ë—Ö —Ç–∞–±–ª–∏—Ü |
| `src/hooks/useGlobalSessionMemory.ts` | ‚úÖ | –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ö—É–∫ –¥–ª—è –≤—Å–µ–π –ø–∞–º—è—Ç–∏ —Å–µ—Å—Å–∏–π (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ sessionId) |
| –ú–∞—Ä—à—Ä—É—Ç `/hydra-memory` | ‚úÖ | –î–æ–±–∞–≤–ª–µ–Ω —Å lazy loading –≤ `App.tsx` |
| –ü—É–Ω–∫—Ç –º–µ–Ω—é | ‚úÖ | `BrainCircuit` –∏–∫–æ–Ω–∫–∞ –≤ `AppSidebar.tsx` |
| –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è | ‚úÖ | –ö–ª—é—á–∏ `memory.hub.*` –≤ `LanguageContext.tsx` |
| –ü–µ—Ä–µ–Ω–æ—Å MemoryControls | ‚úÖ | –£–¥–∞–ª—ë–Ω –∏–∑ —Ö–µ–¥–µ—Ä–∞ ExpertPanel, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ü–∞–º—è—Ç–∏ |
| SessionMemoryDialog | ‚úÖ | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –≤–∫–ª–∞–¥–∫—É ¬´–ü–∞–º—è—Ç—å —Å–µ—Å—Å–∏–π¬ª —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º |

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

- **MemoryControls —É–¥–∞–ª—ë–Ω –∏–∑ ExpertPanel** ‚Äî —Å—Ç–∞—Ç—É—Å-–±–µ–π–¥–∂–∏ –ø–∞–º—è—Ç–∏ –∏ –∫–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ–ø–µ—Ä—å –∂–∏–≤—É—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ü–∞–º—è—Ç–∏
- **useSessionMemory –≤ ExpertPanel** ‚Äî –æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`memoryChunks`), UI-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç
- **useGlobalSessionMemory** ‚Äî –Ω–æ–≤—ã–π —Ö—É–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –í–°–Æ –ø–∞–º—è—Ç—å —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å–µ—Å—Å–∏–∏), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç delete, batch delete, clear all, semantic search

### –¢—Ä–∏ –≤–∫–ª–∞–¥–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

#### üóÇÔ∏è –í–∫–ª–∞–¥–∫–∞ 1: –ü–∞–º—è—Ç—å —Å–µ—Å—Å–∏–π (`session_memory`)
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: –≤—Å–µ–≥–æ —á–∞–Ω–∫–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π, —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- Breakdown –ø–æ —Ç–∏–ø–∞–º —á–∞–Ω–∫–æ–≤ —Å —Ü–≤–µ—Ç–æ–≤—ã–º–∏ –±–µ–π–¥–∂–∞–º–∏ (decision / context / instruction / evaluation / summary / message)
- –ö–Ω–æ–ø–∫–∞ ¬´–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é¬ª ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `SessionMemoryDialog` —Å:
  - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –ø–æ–∏—Å–∫–æ–º
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø–∞–º
  - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º –∏ —É–¥–∞–ª–µ–Ω–∏–µ–º –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
  - –ü–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–æ–π

#### üé≠ –í–∫–ª–∞–¥–∫–∞ 2: –û–ø—ã—Ç —Ä–æ–ª–µ–π (`role_memory`)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –≤—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–æ–ª–µ–π, —Å—Ä–µ–¥–Ω–∏–π confidence
- –°–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π —Å —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–º–∏—Å—è –∑–∞–ø–∏—Å—è–º–∏
- Inline-—É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –¶–≤–µ—Ç–æ–≤—ã–µ –±–µ–π–¥–∂–∏ —Ç–∏–ø–æ–≤: experience / preference / skill / mistake / success

#### üìö –í–∫–ª–∞–¥–∫–∞ 3: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (`role_knowledge`)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —á–∞–Ω–∫–æ–≤ –∑–Ω–∞–Ω–∏–π, —Ä–æ–ª–µ–π —Å –±–∞–∑–æ–π, –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–æ–ª—è–º ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
- –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–∞–∑–¥–µ–ª ¬´–®—Ç–∞—Ç¬ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º—ã–º

---

## üì¶ –ò—Ç–µ—Ä–∞—Ü–∏—è 2 ‚Äî Hybrid Search (–í–´–ü–û–õ–ù–ï–ù–û ‚úÖ)

**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| SQL —Ñ—É–Ω–∫—Ü–∏—è `hybrid_search_session_memory` | ‚úÖ | BM25 (ru/en) + pgvector cosine + RRF (k=60) |
| SQL —Ñ—É–Ω–∫—Ü–∏—è `hybrid_search_role_knowledge` | ‚úÖ | BM25 (ru/en) + pgvector cosine + RRF (k=60) |
| `useSessionMemory.ts` | ‚úÖ | –ú–µ—Ç–æ–¥ `hybridSearch()` —Å fallback –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ |
| `useGlobalSessionMemory.ts` | ‚úÖ | –ú–µ—Ç–æ–¥ `hybridSearch()` (–∫—Ä–æ—Å—Å-—Å–µ—Å—Å–∏–æ–Ω–Ω—ã–π, –≥–ª–æ–±–∞–ª—å–Ω—ã–π) |
| `useRoleKnowledge.ts` | ‚úÖ | –ú–µ—Ç–æ–¥ `hybridSearchKnowledge()` |
| `HydraMemory.tsx` | ‚úÖ | –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞: –¢–µ–∫—Å—Ç / –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π / **–ì–∏–±—Ä–∏–¥–Ω—ã–π** (–∏–∫–æ–Ω–∫–∞ `GitMerge`, —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –∞–∫—Ü–µ–Ω—Ç) |

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

- `supabase/migrations/20260217214126_*.sql` ‚Äî SQL-—Ñ—É–Ω–∫—Ü–∏–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- `src/hooks/useSessionMemory.ts` ‚Äî –º–µ—Ç–æ–¥ `hybridSearch()`
- `src/hooks/useGlobalSessionMemory.ts` ‚Äî –º–µ—Ç–æ–¥ `hybridSearch()`
- `src/hooks/useRoleKnowledge.ts` ‚Äî –º–µ—Ç–æ–¥ `hybridSearchKnowledge()`
- `src/pages/HydraMemory.tsx` ‚Äî UI-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç—Ä—ë—Ö —Ä–µ–∂–∏–º–æ–≤ –ø–æ–∏—Å–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RRF (Reciprocal Rank Fusion)

```sql
-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ SQL-—Ñ—É–Ω–∫—Ü–∏–π
WITH vector_results AS (
  -- cosine similarity —á–µ—Ä–µ–∑ pgvector (<=> –æ–ø–µ—Ä–∞—Ç–æ—Ä)
  SELECT id, content, ..., 1 - (embedding <=> p_query_embedding) AS similarity
  FROM session_memory / role_knowledge
  WHERE user_id = auth.uid()
  ORDER BY embedding <=> p_query_embedding
  LIMIT 60
),
text_results AS (
  -- BM25 full-text search (russian + english dictionaries)
  SELECT id, content, ..., ts_rank(search_vector, query) AS text_rank
  FROM session_memory / role_knowledge
  WHERE search_vector @@ query
  ORDER BY text_rank DESC
  LIMIT 60
),
rrf_merged AS (
  -- Reciprocal Rank Fusion: score = 1/(k+rank_v) + 1/(k+rank_t), k=60
  SELECT id,
    COALESCE(1.0/(60 + ROW_NUMBER() OVER (ORDER BY v.similarity DESC)), 0) +
    COALESCE(1.0/(60 + ROW_NUMBER() OVER (ORDER BY t.text_rank DESC)), 0) AS hybrid_score
  FROM vector_results v FULL OUTER JOIN text_results t USING (id)
)
SELECT * FROM rrf_merged ORDER BY hybrid_score DESC LIMIT p_limit;
```

### –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è
- **–°–ª–æ–≤–∞—Ä–∏:** `russian` + `english` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `tsvector` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤
- **Fallback:** –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ `hybridSearch()` –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç –¥–æ `ilike` —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **k=60:** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ RRF, –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –≤–ª–∏—è–Ω–∏–µ –æ–±–æ–∏—Ö —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–π
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫:** `useGlobalSessionMemory.hybridSearch()` –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ `session_id` ‚Äî –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å—é –ø–∞–º—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üì¶ –ò—Ç–µ—Ä–∞—Ü–∏—è 3 ‚Äî Reranking (–í–´–ü–û–õ–ù–ï–ù–û ‚úÖ)

**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| `KnowledgeChunkCandidate` —Ç–∏–ø | ‚úÖ | `types.ts` ‚Äî –∫–∞–Ω–¥–∏–¥–∞—Ç –¥–ª—è –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è |
| `RankedKnowledgeChunk` —Ç–∏–ø | ‚úÖ | `types.ts` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å `rerank_score` –∏ `final_score` |
| `scoreChunkRelevance()` | ‚úÖ | `tools.ts` ‚Äî LLM-scoring —á–µ—Ä–µ–∑ gemini-3-flash-preview |
| `rerankChunks()` | ‚úÖ | `tools.ts` ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π reranking + fallback |
| `fetchRoleKnowledgeContext()` | ‚úÖ | `tools.ts` ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω: hybrid(top-15) ‚Üí rerank ‚Üí top-5 |
| `index.ts` | ‚úÖ | –ü–µ—Ä–µ–¥–∞—ë—Ç `lovableKey` –≤ `fetchRoleKnowledgeContext` |

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

- `supabase/functions/hydra-orchestrator/types.ts` ‚Äî —Ç–∏–ø—ã `KnowledgeChunkCandidate`, `RankedKnowledgeChunk`
- `supabase/functions/hydra-orchestrator/tools.ts` ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ `scoreChunkRelevance()`, `rerankChunks()`, –æ–±–Ω–æ–≤–ª—ë–Ω `fetchRoleKnowledgeContext()`
- `supabase/functions/hydra-orchestrator/index.ts` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ `lovableKey` –≤ `fetchRoleKnowledgeContext`

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Reranking Pipeline

```
–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  ‚Üí generate-embeddings (text-embedding-3-small)
  ‚Üí hybrid_search_role_knowledge (top-15 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, RRF)
  ‚Üí pre-filter: similarity > 0.2 || hybrid_score > 0.005
  ‚Üí rerankChunks() ‚Äî scoreChunkRelevance() √ó N –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ [gemini-3-flash-preview]
      final_score = rerank_score √ó 0.7 + hybrid_score √ó 0.3
  ‚Üí top-5 –ø–æ final_score
  ‚Üí –∏–Ω—ä–µ–∫—Ü–∏—è –≤ system prompt –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞
```

### –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è
- **–ú–æ–¥–µ–ª—å reranker:** `google/gemini-3-flash-preview` ‚Äî –±—ã—Å—Ç—Ä—ã–π, –¥–µ—à—ë–≤—ã–π, –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ API-–∫–ª—é—á–∞
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å:** –≤—Å–µ —á–∞–Ω–∫–∏ —Ä–∞–Ω–∂–∏—Ä—É—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ `Promise.all`
- **Fallback:** –ø—Ä–∏ –æ—à–∏–±–∫–µ reranking –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `hybrid_score` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–ü–æ—Ä–æ–≥ pre-filter:** `similarity > 0.2 || hybrid_score > 0.005` ‚Äî –æ—Ç—Å–µ–∫–∞–µ—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π —à—É–º –¥–æ reranking
- **–§–æ—Ä–º—É–ª–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∫–æ—Ä–∞:** `final_score = rerank √ó 0.7 + hybrid √ó 0.3`
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** —Å—Ç–∞—Ä—ã–π `search_role_knowledge` (—á–∏—Å—Ç—ã–π –≤–µ–∫—Ç–æ—Ä–Ω—ã–π) –Ω–µ —Ç—Ä–æ–Ω—É—Ç

---

## üì¶ –ò—Ç–µ—Ä–∞—Ü–∏—è 4 ‚Äî HyDE (–í–´–ü–û–õ–ù–ï–ù–û ‚úÖ)

**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| `HydeConfig` —Ç–∏–ø | ‚úÖ | `types.ts` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HyDE (hydeWeight, maxTokens) |
| `generateHydeDocument()` | ‚úÖ | `tools.ts` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ gemini-3-flash-preview |
| `blendEmbeddings()` | ‚úÖ | `tools.ts` ‚Äî –≤–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Å–º–µ—à–µ–Ω–∏–µ + L2-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–≤—É—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ |
| `fetchRoleKnowledgeContext()` | ‚úÖ | `tools.ts` ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ embedding + HyDE –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

- `supabase/functions/hydra-orchestrator/types.ts` ‚Äî —Ç–∏–ø `HydeConfig`
- `supabase/functions/hydra-orchestrator/tools.ts` ‚Äî `generateHydeDocument()`, `blendEmbeddings()`, –æ–±–Ω–æ–≤–ª—ë–Ω `fetchRoleKnowledgeContext()`

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ HyDE Pipeline

```
–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  ‚Üì (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
  ‚îú‚îÄ‚îÄ generate-embeddings(–∑–∞–ø—Ä–æ—Å)         ‚Üí query_emb
  ‚îî‚îÄ‚îÄ generateHydeDocument(–∑–∞–ø—Ä–æ—Å, —Ä–æ–ª—å) ‚Üí –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π_–æ—Ç–≤–µ—Ç
                                              ‚Üì
                                         generate-embeddings(–≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π_–æ—Ç–≤–µ—Ç) ‚Üí hyde_emb
  ‚Üì
  blendEmbeddings(query_emb√ó0.4, hyde_emb√ó0.6) + L2-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí combined_emb
  ‚Üì
  hybrid_search_role_knowledge(combined_emb, query_text, top-15)
  ‚Üì
  rerankChunks() [gemini-3-flash-preview]
  ‚Üì
  top-5 ‚Üí system prompt injection (–º–µ—Ç–∫–∞: hybrid+hyde-blend+reranking)
```

### –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å:** `generate-embeddings` –∏ `generateHydeDocument()` –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ `Promise.all`
- **–§–æ—Ä–º—É–ª–∞ blend:** `combined = query√ó0.4 + hyde√ó0.6`, –∑–∞—Ç–µ–º L2-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
- **–ú–æ–¥–µ–ª—å HyDE:** `google/gemini-3-flash-preview`, max_tokens=200, temperature=0.3
- **Fallback:** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ LLM –∏–ª–∏ –æ—à–∏–±–∫–µ blend ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∏—Å—Ç—ã–π `query_emb`
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** `searchMode` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –º–µ—Ç–∫—É `searchType` –≤ –ª–æ–≥–∞—Ö –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø—Ä–æ–º–ø—Ç–∞

---

## üì¶ –ò—Ç–µ—Ä–∞—Ü–∏—è 7 ‚Äî UX-–ø–æ–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∞ (–í–´–ü–û–õ–ù–ï–ù–û ‚úÖ)

**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø | ‚úÖ | –£–±—Ä–∞–Ω `max-w-4xl mx-auto`, —É–≤–µ–ª–∏—á–µ–Ω padding `lg:p-8` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É |
| –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≥—Ä–∞—Ñ | ‚úÖ | SVG —É–º–µ–Ω—å—à–µ–Ω —Å `740√ó460` –¥–æ `520√ó320`, —Ä–∞–¥–∏—É—Å—ã –Ω–æ–¥, —à—Ä–∏—Ñ—Ç—ã –∏ –æ—Ç—Å—Ç—É–ø—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ ~50% |
| –§–∏–∫—Å–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –≥—Ä–∞—Ñ–∞ | ‚úÖ | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω `max-w-[520px]` ‚Äî –≥—Ä–∞—Ñ –±–æ–ª—å—à–µ –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω |
| –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–∫ | ‚úÖ | `ROLE_CONFIG` + `t(roleConfig.label)` ‚Äî –º–µ—Ç–∫–∏ —Ä–æ–ª–µ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —è–∑—ã–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ |
| –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–∑–µ–ª | ‚úÖ | ¬´–ì–∏–¥—Ä–∞¬ª / ¬´Hydra¬ª –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é `language === 'ru'` |

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã
- `src/pages/HydraMemory.tsx` ‚Äî `MemoryGraphTab`: –∏–º–ø–æ—Ä—Ç `ROLE_CONFIG`, —Ö—É–∫ `useLanguage`, `useMemo` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é `[t, language]`, `max-w-[520px]` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

---

## üó∫Ô∏è –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ ‚Äî –°–ª–µ–¥—É—é—â–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏

### –ò—Ç–µ—Ä–∞—Ü–∏—è 5 ‚Äî –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è role_knowledge (–í–´–ü–û–õ–ù–ï–ù–û ‚úÖ)

**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| `KnowledgeTab` –≤ HydraMemory | ‚úÖ | –ü–∞–Ω–µ–ª—å ¬´–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—á–∏—Å—Ç–∫–∏¬ª ‚Äî –∞–∫–∫–æ—Ä–¥–µ–æ–Ω —Å –∫–Ω–æ–ø–∫–æ–π ¬´–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å¬ª |
| –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö | ‚úÖ | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —á–∞–Ω–∫–æ–≤ —Å –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º content (–ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤) |
| –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö | ‚úÖ | –ß–∞–Ω–∫–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `source_url` –∏ –Ω–µ-–ø–æ—Å–ª–µ–¥–Ω–µ–π `version` |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ | ‚úÖ | –°—Ä–µ–¥–Ω–µ–µ —Å–ª–æ–≤/—á–∞–Ω–∫, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–∑ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |
| Bulk delete | ‚úÖ | –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π |

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è `id, content, source_url, version, embedding` –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –¥–µ—Ç–µ–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ JS.

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 6 ‚Äî Memory Graph (–í–´–ü–û–õ–ù–ï–ù–û ‚úÖ)

**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| `MemoryGraphTab` | ‚úÖ | –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ ¬´–ì—Ä–∞—Ñ –ø–∞–º—è—Ç–∏¬ª –≤ HydraMemory |
| SVG-–≥—Ä–∞—Ñ | ‚úÖ | –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–∑–µ–ª –ì–∏–¥—Ä–∞ ‚Üí —Ä–æ–ª–∏ –ø–æ –∫—Ä—É–≥—É ‚Üí —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ |
| –ì–æ—Ä—è—á–∏–µ —Ä–æ–ª–∏ | ‚úÖ | –ü—É–Ω–∫—Ç–∏—Ä–Ω—ã–π –æ—Ä–µ–æ–ª + –∏–∫–æ–Ω–∫–∞ ‚ö° –¥–ª—è —Ä–æ–ª–µ–π —Å –≤—ã—Å–æ–∫–∏–º `usage_count` |
| –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | ‚úÖ | Hover-glow, –∫–ª–∏–∫ ‚Üí –¥–µ—Ç–∞–ª–∏ —É–∑–ª–∞ (–∫–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Å–µ—Å—Å–∏–∏) |
| –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–æ–ª–µ–π | ‚úÖ | –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –ø–æ–¥ –≥—Ä–∞—Ñ–æ–º: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º |

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `src/pages/HydraMemory.tsx` ‚Äî `KnowledgeTab` (—Ä–∞—Å—à–∏—Ä–µ–Ω), `MemoryGraphTab` (–Ω–æ–≤—ã–π), –Ω–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –≤ –≥–ª–∞–≤–Ω–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ

---

## üíæ –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–∞—á–∞–ª–æ –ø—Ä–æ–µ–∫—Ç–∞)

```
session_memory:  ~160 –∑–∞–ø–∏—Å–µ–π  (—Ç–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å —Å–µ—Å—Å–∏–π)
role_memory:      ~27 –∑–∞–ø–∏—Å–µ–π  (–æ–ø—ã—Ç 27 —Ä–æ–ª–µ–π)
role_knowledge:   ~88 –∑–∞–ø–∏—Å–µ–π  (–±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —à—Ç–∞—Ç–∞)
```

**–¢–∞–±–ª–∏—Ü—ã:**
```sql
session_memory  (id, session_id, user_id, content, chunk_type, embedding, metadata, created_at)
role_memory     (id, role, user_id, content, memory_type, confidence_score, embedding, usage_count, tags)
role_knowledge  (id, role, user_id, content, category, chunk_index, chunk_total, source_title, source_url, version, embedding, tags)
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –ø–∞–º—è—Ç–∏ –ì–∏–¥—Ä—ã

```
pgvector        ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ –≤–µ–∫—Ç–æ—Ä–æ–≤ (cosine similarity)
generate-embeddings ‚Äî Edge Function –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (text-embedding-3-small)
search_*_memory ‚Äî RPC PostgreSQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
useSessionMemory        ‚Äî —Ö—É–∫ –¥–ª—è –ø–∞–º—è—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏ (streaming context)
useGlobalSessionMemory  ‚Äî —Ö—É–∫ –¥–ª—è –≤—Å–µ–π –ø–∞–º—è—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (HydraMemory page)
useHydraMemoryStats     ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –≤—Å–µ–º —Ç—Ä—ë–º —Å–ª–æ—è–º
SessionMemoryDialog     ‚Äî UI –ø–æ–∏—Å–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞–Ω–∫–∞–º–∏
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

1. **`useSessionMemory` –≤ ExpertPanel** ‚Äî –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å. –û–Ω –Ω—É–∂–µ–Ω –¥–ª—è `memoryChunks`, –∫–æ—Ç–æ—Ä—ã–µ –∏–¥—É—Ç –≤ `streamContext` –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞.
2. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –Ω–∞ HydraMemory** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `p_session_id: ''` –≤ RPC. PostgreSQL RLS –∏–∑–æ–ª–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ `user_id`, –ø–æ—ç—Ç–æ–º—É –ø—É—Å—Ç–æ–π session_id –≤–µ—Ä–Ω—ë—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *(–Ω—É–∂–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤ –ë–î ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `search_all_session_memory`)*.
3. **MemoryControls** ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–¥–∞–ª—ë–Ω –∏–∑ ExpertPanel, –Ω–æ —Å–∞–º —Ñ–∞–π–ª `src/components/layout/MemoryControls.tsx` —Å–æ—Ö—Ä–∞–Ω—ë–Ω –Ω–∞ —Å–ª—É—á–∞–π –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
4. **–î–∏–∑–∞–π–Ω-—Ç–æ–∫–µ–Ω** ‚Äî `hsl(var(--hydra-memory))` = violet. –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∞–º—è—Ç–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω.
