# üß† Plan: Hydra Memory ‚Äî RAG Management Hub

> –†–∞–±–æ—á–∏–π –ø–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è —Ä–∞–∑–¥–µ–ª–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –ò–ò-–ì–∏–¥—Ä—ã.  
> –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ –∏—Ç–æ–≥–∞–º –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

---

## üìã –†–µ–∑—é–º–µ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É RAG (–∞–Ω–∞–ª–∏–∑ Lovable)

*–ò–∑—É—á–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö —Ä–∞–±–æ—Ç—ã —Å RAG –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏. –ù–∏–∂–µ ‚Äî –æ—Ü–µ–Ω–∫–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ì–∏–¥—Ä—ã.*

### ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –ì–∏–¥—Ä–µ

| –ú–µ—Ç–æ–¥ | –ì–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
|-------|---------------|
| **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (pgvector)** | `search_session_memory`, `search_role_memory`, `search_role_knowledge` ‚Äî RPC-—Ñ—É–Ω–∫—Ü–∏–∏ —Å cosine similarity |
| **–¢—Ä–∏ —É—Ä–æ–≤–Ω—è –ø–∞–º—è—Ç–∏** | `session_memory` (—Ç–∞–∫—Ç–∏–∫–∞), `role_memory` (–æ–ø—ã—Ç), `role_knowledge` (–∑–Ω–∞–Ω–∏—è) |
| **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** | `SessionMemoryDialog` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ text/semantic, UI —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º —Å—Ö–æ–∂–µ—Å—Ç–∏ |
| **Confidence score** | `role_memory.confidence_score` ‚Äî –æ—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –æ–ø—ã—Ç–∞ |
| **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è** | –ß–∞–Ω–∫–∏ –ø–∞–º—è—Ç–∏ —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `streamContext` –ø—Ä–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–º —Å—Ç—Ä–∏–º–∏–Ω–≥–µ |
| **Agentic RAG** | –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å (`archivist`) ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–æ–ª—å-–∞–≥–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é |
| **Chunking** | `chunk_index`, `chunk_total` –≤ `role_knowledge` ‚Äî —Ä–∞–∑–±–∏–≤–∫–∞ –∑–Ω–∞–Ω–∏–π –Ω–∞ —á–∞—Å—Ç–∏ |
| **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** | –ü–æ–ª—è `tags`, `source_title`, `source_url`, `version` –≤ `role_knowledge` |
| **Context Compression** | –¢–æ–ª—å–∫–æ —Ç–æ–ø-N —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ similarity –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–æ–¥–µ–ª–∏ |

### üö´ –ù–µ –Ω—É–∂–Ω–æ –ì–∏–¥—Ä–µ

| –ú–µ—Ç–æ–¥ | –ü–æ—á–µ–º—É |
|-------|--------|
| **LangChain / LlamaIndex** | –ì–∏–¥—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –Ω–∞ Supabase + edge functions. –§—Ä–µ–π–º–≤–æ—Ä–∫–∏ –¥–æ–±–∞–≤—è—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±–µ–∑ –≤—ã–≥–æ–¥—ã |
| **ColBERT** | –¢—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (GPU). –î–ª—è –∑–∞–¥–∞—á –ì–∏–¥—Ä—ã pgvector –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ |
| **Self-RAG** | –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç self-critique loop —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ LLM-–≤—ã–∑–æ–≤–∞–º–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å. –î–æ—Ä–æ–≥–æ, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ —Å–ª–æ–∂–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–∞—Å—à—Ç–∞–±–∞ |
| **RAPTOR** | –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤—å–µ–≤ ‚Äî –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π |

### üí° –ì–∏–¥—Ä–∞ –¥–µ–ª–∞–µ—Ç –ª—É—á—à–µ, —á–µ–º –æ–ø–∏—Å–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ

| –ö–æ–Ω—Ü–µ–ø—Ü–∏—è | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –ì–∏–¥—Ä–µ |
|-----------|-------------------|
| **Agentic RAG** | –ù–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É ‚Äî –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è —Ä–æ–ª—å –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º, –æ–ø—ã—Ç–æ–º –∏ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π. –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —á–∞—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ |
| **Memory Layers** | –¢—Ä–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è (—Å–µ—Å—Å–∏—è / –æ–ø—ã—Ç / –∑–Ω–∞–Ω–∏—è) –≤–º–µ—Å—Ç–æ –ø–ª–æ—Å–∫–æ–≥–æ –µ–¥–∏–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ |
| **Context Compression** | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ `p_limit` –≤ RPC-—Ñ—É–Ω–∫—Ü–∏—è—Ö |

### üöÄ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–∑–∞–¥–µ–ª –Ω–∞ –±—É–¥—É—â–µ–µ)

| –ú–µ—Ç–æ–¥ | –¶–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –ì–∏–¥—Ä—ã | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-------|-------------------|-----------|
| **Hybrid Search (BM25 + vector)** | –¢–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∞–º –º–æ–¥–µ–ª–µ–π, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º —Ç–µ—Ä–º–∏–Ω–∞–º, –∫–æ–¥–æ–≤—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º | üî¥ –í—ã—Å–æ–∫–∏–π |
| **Reranking (Cross-encoder)** | –ü–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ —Ç–æ–ø-20 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ—Å–ª–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞. –£–ª—É—á—à–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –¥–ª—è –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞ | üî¥ –í—ã—Å–æ–∫–∏–π |
| **HyDE (Hypothetical Document Embeddings)** | –ü–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –∏ –∏—Å–∫–∞—Ç—å –ø–æ –Ω–µ–º—É. –û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è role_knowledge | üü° –°—Ä–µ–¥–Ω–∏–π |
| **Parent-Document Retrieval** | –•—Ä–∞–Ω–∏—Ç—å –º–µ–ª–∫–∏–µ —á–∞–Ω–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –£–ª—É—á—à–∞–µ—Ç —Å–≤—è–∑–Ω–æ—Å—Ç—å | üü° –°—Ä–µ–¥–Ω–∏–π |
| **Lost in the Middle mitigation** | –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤: –≤–∞–∂–Ω—ã–µ ‚Äî –≤ –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –ø—Ä–æ–º–ø—Ç–∞, –∞ –Ω–µ –≤ —Å–µ—Ä–µ–¥–∏–Ω—É | üü° –°—Ä–µ–¥–Ω–∏–π |
| **Adaptive Chunking** | –†–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —á–∞–Ω–∫–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∫–æ–¥ vs. —Ç–µ–∫—Å—Ç vs. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏) | üü¢ –ù–∏–∑–∫–∏–π |
| **Memory Graph (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)** | –ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Å–ª–æ—è–º–∏ –ø–∞–º—è—Ç–∏. –ö—Ä–∞—Å–∏–≤–æ, –Ω–æ –Ω–µ —Å—Ä–æ—á–Ω–æ | üü¢ –ù–∏–∑–∫–∏–π |

---

## üì¶ –ò—Ç–µ—Ä–∞—Ü–∏—è 1 ‚Äî –§—É–Ω–¥–∞–º–µ–Ω—Ç (–í–´–ü–û–õ–ù–ï–ù–û ‚úÖ)

**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| `src/pages/HydraMemory.tsx` | ‚úÖ | –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç—Ä–µ–º—è –≤–∫–ª–∞–¥–∫–∞–º–∏ |
| `src/hooks/useHydraMemoryStats.ts` | ‚úÖ | –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ –≤—Å–µ—Ö —Ç—Ä—ë—Ö —Ç–∞–±–ª–∏—Ü |
| `src/hooks/useGlobalSessionMemory.ts` | ‚úÖ | –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ö—É–∫ –¥–ª—è –≤—Å–µ–π –ø–∞–º—è—Ç–∏ —Å–µ—Å—Å–∏–π (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ sessionId) |
| –ú–∞—Ä—à—Ä—É—Ç `/hydra-memory` | ‚úÖ | –î–æ–±–∞–≤–ª–µ–Ω —Å lazy loading –≤ `App.tsx` |
| –ü—É–Ω–∫—Ç –º–µ–Ω—é | ‚úÖ | `BrainCircuit` –∏–∫–æ–Ω–∫–∞ –≤ `AppSidebar.tsx` |
| –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è | ‚úÖ | –ö–ª—é—á–∏ `memory.hub.*` –≤ `LanguageContext.tsx` |
| –ü–µ—Ä–µ–Ω–æ—Å MemoryControls | ‚úÖ | –£–¥–∞–ª—ë–Ω –∏–∑ —Ö–µ–¥–µ—Ä–∞ ExpertPanel, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ü–∞–º—è—Ç–∏ |
| SessionMemoryDialog | ‚úÖ | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –≤–∫–ª–∞–¥–∫—É ¬´–ü–∞–º—è—Ç—å —Å–µ—Å—Å–∏–π¬ª —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º |

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

- **MemoryControls —É–¥–∞–ª—ë–Ω –∏–∑ ExpertPanel** ‚Äî —Å—Ç–∞—Ç—É—Å-–±–µ–π–¥–∂–∏ –ø–∞–º—è—Ç–∏ –∏ –∫–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ–ø–µ—Ä—å –∂–∏–≤—É—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ü–∞–º—è—Ç–∏
- **useSessionMemory –≤ ExpertPanel** ‚Äî –æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`memoryChunks`), UI-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç
- **useGlobalSessionMemory** ‚Äî –Ω–æ–≤—ã–π —Ö—É–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –í–°–Æ –ø–∞–º—è—Ç—å —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å–µ—Å—Å–∏–∏), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç delete, batch delete, clear all, semantic search

### –¢—Ä–∏ –≤–∫–ª–∞–¥–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

#### üóÇÔ∏è –í–∫–ª–∞–¥–∫–∞ 1: –ü–∞–º—è—Ç—å —Å–µ—Å—Å–∏–π (`session_memory`)
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: –≤—Å–µ–≥–æ —á–∞–Ω–∫–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π, —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- Breakdown –ø–æ —Ç–∏–ø–∞–º —á–∞–Ω–∫–æ–≤ —Å —Ü–≤–µ—Ç–æ–≤—ã–º–∏ –±–µ–π–¥–∂–∞–º–∏ (decision / context / instruction / evaluation / summary / message)
- –ö–Ω–æ–ø–∫–∞ ¬´–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é¬ª ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `SessionMemoryDialog` —Å:
  - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –ø–æ–∏—Å–∫–æ–º
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø–∞–º
  - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º –∏ —É–¥–∞–ª–µ–Ω–∏–µ–º –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
  - –ü–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–æ–π

#### üé≠ –í–∫–ª–∞–¥–∫–∞ 2: –û–ø—ã—Ç —Ä–æ–ª–µ–π (`role_memory`)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –≤—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–æ–ª–µ–π, —Å—Ä–µ–¥–Ω–∏–π confidence
- –°–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π —Å —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–º–∏—Å—è –∑–∞–ø–∏—Å—è–º–∏
- Inline-—É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –¶–≤–µ—Ç–æ–≤—ã–µ –±–µ–π–¥–∂–∏ —Ç–∏–ø–æ–≤: experience / preference / skill / mistake / success

#### üìö –í–∫–ª–∞–¥–∫–∞ 3: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (`role_knowledge`)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —á–∞–Ω–∫–æ–≤ –∑–Ω–∞–Ω–∏–π, —Ä–æ–ª–µ–π —Å –±–∞–∑–æ–π, –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–æ–ª—è–º ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
- –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–∞–∑–¥–µ–ª ¬´–®—Ç–∞—Ç¬ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º—ã–º

---

## üó∫Ô∏è –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ ‚Äî –°–ª–µ–¥—É—é—â–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏

### –ò—Ç–µ—Ä–∞—Ü–∏—è 2 ‚Äî Hybrid Search (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô)

**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏–º–µ–Ω–∞–º, —Ç–µ—Ä–º–∏–Ω–∞–º, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º.

- –î–æ–±–∞–≤–∏—Ç—å `tsvector`-–∏–Ω–¥–µ–∫—Å –Ω–∞ `session_memory.content` –∏ `role_knowledge.content`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å RPC-—Ñ—É–Ω–∫—Ü–∏—é `hybrid_search_session_memory(query, embedding, alpha)` –≥–¥–µ `alpha` –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –≤–µ—Å vector vs BM25
- –û–±–Ω–æ–≤–∏—Ç—å `useGlobalSessionMemory.semanticSearch` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- UI-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ `SessionMemoryDialog`: —Ä–µ–∂–∏–º ¬´–¢–æ—á–Ω—ã–π¬ª (BM25+) / ¬´–°–º—ã—Å–ª–æ–≤–æ–π¬ª (vector) / ¬´–ì–∏–±—Ä–∏–¥–Ω—ã–π¬ª

**–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:**
- `supabase/migrations/` ‚Äî –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏–Ω–¥–µ–∫—Å—ã
- `src/hooks/useGlobalSessionMemory.ts` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å `semanticSearch`
- `src/components/warroom/SessionMemoryDialog.tsx` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞

### –ò—Ç–µ—Ä–∞—Ü–∏—è 3 ‚Äî Reranking –¥–ª—è –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô)

**–¶–µ–ª—å:** –ü–æ–≤—ã—Å–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –∑–Ω–∞–Ω–∏–π, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å—É.

- –í `search_role_knowledge` –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–ø-20 –ø–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º—É –ø–æ–∏—Å–∫—É
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Ö —á–µ—Ä–µ–∑ edge function –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞ –¥–ª—è cross-encoder reranking
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–æ–ø-5 —É–∂–µ –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ø—Ä–æ–º–ø—Ç
- –í HydraMemory: –∫–∞—Ä—Ç–æ—á–∫–∞ ¬´–ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞¬ª —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ reranking

**–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:**
- `supabase/functions/hydra-orchestrator/` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å reranking-—à–∞–≥
- `src/hooks/useRoleKnowledge.ts` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞

### –ò—Ç–µ—Ä–∞—Ü–∏—è 4 ‚Äî HyDE –¥–ª—è —É–≥–ª—É–±–ª—ë–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)

**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º –∑–∞–ø—Ä–æ—Å–∞–º –≤ role_knowledge.

- –í —Ö—É–∫–µ –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞: –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å ¬´–≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç¬ª –Ω–∞ –∑–∞–ø—Ä–æ—Å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å embedding –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ role_knowledge
- Combine: (embedding –∑–∞–ø—Ä–æ—Å–∞ √ó 0.4) + (embedding –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ √ó 0.6)
- –§–ª–∞–≥ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å–∞: `use_hyde: boolean`

### –ò—Ç–µ—Ä–∞—Ü–∏—è 5 ‚Äî –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è role_knowledge (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)

**–¶–µ–ª—å:** –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –≤–µ—Ä—Å–∏–π.

- –î–æ–±–∞–≤–∏—Ç—å –≤–∫–ª–∞–¥–∫—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ –≤–∫–ª–∞–¥–∫—É ¬´–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π¬ª –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ü–∞–º—è—Ç–∏:
  - ¬´–ù–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ¬ª ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —á–∞–Ω–∫–æ–≤ —Å cosine similarity > 0.9
  - ¬´–£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ¬ª ‚Äî —á–∞–Ω–∫–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `source_url` –∏ –±–æ–ª–µ–µ —Å—Ç–∞—Ä—ã–º `version`
  - ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞¬ª ‚Äî —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ —Å–ª–æ–≤ –Ω–∞ —á–∞–Ω–∫, –ø—Ä–æ—Ü–µ–Ω—Ç –±–µ–∑ embedding

### –ò—Ç–µ—Ä–∞—Ü–∏—è 6 ‚Äî Memory Graph (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)

**–¶–µ–ª—å:** –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –ø–∞–º—è—Ç—å—é –∏ —Ä–æ–ª—è–º–∏.

- –î–∏–∞–≥—Ä–∞–º–º–∞: —Ä–æ–ª–∏ ‚Üí –∏—Ö –∑–∞–ø–∏—Å–∏ –≤ role_memory ‚Üí —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è ¬´–≥–æ—Ä—è—á–∏—Ö¬ª —Ä–æ–ª–µ–π (–≤—ã—Å–æ–∫–∏–π usage_count)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FlowEditor –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∫–∞–∫ —É–∑–ª–æ–≤ –≥—Ä–∞—Ñ–∞

---

## üíæ –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–∞—á–∞–ª–æ –ø—Ä–æ–µ–∫—Ç–∞)

```
session_memory:  ~160 –∑–∞–ø–∏—Å–µ–π  (—Ç–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å —Å–µ—Å—Å–∏–π)
role_memory:      ~27 –∑–∞–ø–∏—Å–µ–π  (–æ–ø—ã—Ç 27 —Ä–æ–ª–µ–π)
role_knowledge:   ~88 –∑–∞–ø–∏—Å–µ–π  (–±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —à—Ç–∞—Ç–∞)
```

**–¢–∞–±–ª–∏—Ü—ã:**
```sql
session_memory  (id, session_id, user_id, content, chunk_type, embedding, metadata, created_at)
role_memory     (id, role, user_id, content, memory_type, confidence_score, embedding, usage_count, tags)
role_knowledge  (id, role, user_id, content, category, chunk_index, chunk_total, source_title, source_url, version, embedding, tags)
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –ø–∞–º—è—Ç–∏ –ì–∏–¥—Ä—ã

```
pgvector        ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ –≤–µ–∫—Ç–æ—Ä–æ–≤ (cosine similarity)
generate-embeddings ‚Äî Edge Function –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (text-embedding-3-small)
search_*_memory ‚Äî RPC PostgreSQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
useSessionMemory        ‚Äî —Ö—É–∫ –¥–ª—è –ø–∞–º—è—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏ (streaming context)
useGlobalSessionMemory  ‚Äî —Ö—É–∫ –¥–ª—è –≤—Å–µ–π –ø–∞–º—è—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (HydraMemory page)
useHydraMemoryStats     ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –≤—Å–µ–º —Ç—Ä—ë–º —Å–ª–æ—è–º
SessionMemoryDialog     ‚Äî UI –ø–æ–∏—Å–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞–Ω–∫–∞–º–∏
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

1. **`useSessionMemory` –≤ ExpertPanel** ‚Äî –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å. –û–Ω –Ω—É–∂–µ–Ω –¥–ª—è `memoryChunks`, –∫–æ—Ç–æ—Ä—ã–µ –∏–¥—É—Ç –≤ `streamContext` –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞.
2. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –Ω–∞ HydraMemory** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `p_session_id: ''` –≤ RPC. PostgreSQL RLS –∏–∑–æ–ª–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ `user_id`, –ø–æ—ç—Ç–æ–º—É –ø—É—Å—Ç–æ–π session_id –≤–µ—Ä–Ω—ë—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *(–Ω—É–∂–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤ –ë–î ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `search_all_session_memory`)*.
3. **MemoryControls** ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–¥–∞–ª—ë–Ω –∏–∑ ExpertPanel, –Ω–æ —Å–∞–º —Ñ–∞–π–ª `src/components/layout/MemoryControls.tsx` —Å–æ—Ö—Ä–∞–Ω—ë–Ω –Ω–∞ —Å–ª—É—á–∞–π –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
4. **–î–∏–∑–∞–π–Ω-—Ç–æ–∫–µ–Ω** ‚Äî `hsl(var(--hydra-memory))` = violet. –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∞–º—è—Ç–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω.
