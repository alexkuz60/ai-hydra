

## –ü–ª–∞–Ω: –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ TreeNav + Resizable –ø–∞–Ω–µ–ª—å

### –¶–µ–ª—å
1. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é ‚Äî –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –°—É–ø–µ—Ä–≤–∏–∑–æ—Ä–∞ —Å –¥–æ—á–µ—Ä–Ω–∏–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –ò–ò –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω—è–µ–º—É—é —à–∏—Ä–∏–Ω—É –ø–∞–Ω–µ–ª–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

---

### –ß–∞—Å—Ç—å 1: –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º. –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å **–±–ª–æ–∫–∏ –¥–∏–∞–ª–æ–≥–∞**:

```text
–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:           –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üëë –°—É–ø–µ—Ä–≤–∏–∑–æ—Ä (3)   ‚îÇ      ‚îÇ üëë –°—É–ø–µ—Ä–≤–∏–∑–æ—Ä #1                    ‚îÇ
‚îÇ ‚îú‚îÄ üß† GPT-5 (3)     ‚îÇ  ‚Üí   ‚îÇ ‚îÇ  "–ù–∞—á–∞–ª–æ –∑–∞–ø—Ä–æ—Å–∞..." (tooltip)   ‚îÇ
‚îÇ ‚îî‚îÄ üõ° Claude (3)    ‚îÇ      ‚îÇ ‚îú‚îÄ üõ° –ö—Ä–∏—Ç–∏–∫ GPT-5                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ ‚îî‚îÄ üß† –≠–∫—Å–ø–µ—Ä—Ç Claude                ‚îÇ
                             ‚îÇ üëë –°—É–ø–µ—Ä–≤–∏–∑–æ—Ä #2                    ‚îÇ
                             ‚îÇ ‚îú‚îÄ üß† –≠–∫—Å–ø–µ—Ä—Ç Claude                ‚îÇ
                             ‚îÇ ‚îî‚îÄ üõ° –ö—Ä–∏—Ç–∏–∫ GPT-5                  ‚îÇ
                             ‚îÇ üí° –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç-–º–∞—Ç–µ–º–∞—Ç–∏–∫            ‚îÇ
                             ‚îÇ üëë –°—É–ø–µ—Ä–≤–∏–∑–æ—Ä #3                    ‚îÇ
                             ‚îÇ ‚îú‚îÄ ...                              ‚îÇ
                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### –ß–∞—Å—Ç—å 2: –ù–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
interface DialogBlock {
  id: string;              // ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä–∞ –∏–ª–∏ standalone AI
  type: 'supervisor-block' | 'standalone-ai';
  supervisorMessage?: Message;  // –°–æ–æ–±—â–µ–Ω–∏–µ —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
  contentPreview: string;       // –ü–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è tooltip
  aiResponses: AIResponse[];    // –û—Ç–≤–µ—Ç—ã –ò–ò –≤ –ø–æ—Ä—è–¥–∫–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è
}

interface AIResponse {
  id: string;           // ID —Å–æ–æ–±—â–µ–Ω–∏—è
  modelName: string;    // –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
  role: MessageRole;    // assistant | critic | arbiter | consultant
  icon: LucideIcon;
  color: string;
  displayName: string;  // "–ö—Ä–∏—Ç–∏–∫ GPT-5" –∏–ª–∏ "–≠–∫—Å–ø–µ—Ä—Ç Claude"
}
```

---

### –ß–∞—Å—Ç—å 3: –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞

```typescript
const dialogBlocks = useMemo(() => {
  const blocks: DialogBlock[] = [];
  let currentBlock: DialogBlock | null = null;

  messages.forEach((msg, index) => {
    if (msg.role === 'user') {
      // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞ —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä–∞
      if (currentBlock) {
        blocks.push(currentBlock);
      }
      currentBlock = {
        id: msg.id,
        type: 'supervisor-block',
        supervisorMessage: msg,
        contentPreview: msg.content.slice(0, 50) + (msg.content.length > 50 ? '...' : ''),
        aiResponses: [],
      };
    } else {
      // –û—Ç–≤–µ—Ç –ò–ò
      const settings = perModelSettings[msg.model_name || ''];
      const role = settings?.role || msg.role;
      const config = roleConfig[role] || roleConfig.assistant;
      
      const aiResponse: AIResponse = {
        id: msg.id,
        modelName: msg.model_name || 'unknown',
        role: role as MessageRole,
        icon: config.icon,
        color: config.color,
        displayName: `${t(`role.${role}`)} ${getModelShortName(msg.model_name)}`,
      };

      if (currentBlock) {
        // –î–æ–±–∞–≤–ª—è–µ–º –∫ —Ç–µ–∫—É—â–µ–º—É –±–ª–æ–∫—É —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä–∞
        currentBlock.aiResponses.push(aiResponse);
      } else {
        // Standalone AI —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –±–µ–∑ –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
        blocks.push({
          id: msg.id,
          type: 'standalone-ai',
          contentPreview: msg.content.slice(0, 50) + '...',
          aiResponses: [aiResponse],
        });
      }
    }
  });

  // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–ª–æ–∫
  if (currentBlock) {
    blocks.push(currentBlock);
  }

  return blocks;
}, [messages, perModelSettings, t]);
```

---

### –ß–∞—Å—Ç—å 4: –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

```tsx
return (
  <div className="flex flex-col h-full bg-sidebar">
    <div className="p-3 border-b border-border">
      <h3 className="text-sm font-medium text-sidebar-foreground flex items-center gap-2">
        <Users className="h-4 w-4" />
        {t('chat.participants')}
      </h3>
    </div>

    <ScrollArea className="flex-1">
      <div className="p-2 space-y-0.5">
        {dialogBlocks.map((block, blockIndex) => (
          <div key={block.id} className="space-y-0.5">
            {/* Supervisor node */}
            {block.type === 'supervisor-block' && (
              <Tooltip>
                <TooltipTrigger asChild>
                  <div
                    className={cn(
                      "flex items-center gap-2 p-2 rounded-md cursor-pointer",
                      activeParticipant === block.id && "bg-sidebar-accent",
                      "hover:bg-sidebar-accent/50"
                    )}
                    onClick={() => onMessageClick(block.id)}
                  >
                    <Crown className="h-4 w-4 text-amber-500 shrink-0" />
                    <span className="flex-1 text-sm truncate">
                      {t('role.supervisor')} #{blockIndex + 1}
                    </span>
                    <Info className="h-3.5 w-3.5 text-muted-foreground" />
                  </div>
                </TooltipTrigger>
                <TooltipContent side="right" className="max-w-xs">
                  <p className="text-sm italic">"{block.contentPreview}"</p>
                </TooltipContent>
              </Tooltip>
            )}

            {/* AI responses under this supervisor */}
            {block.aiResponses.map((ai) => {
              const Icon = ai.icon;
              return (
                <div
                  key={ai.id}
                  className={cn(
                    "relative flex items-center gap-2 p-2 rounded-md cursor-pointer ml-4",
                    activeParticipant === ai.id && "bg-sidebar-accent",
                    "hover:bg-sidebar-accent/50"
                  )}
                  onClick={() => onMessageClick(ai.id)}
                >
                  {/* Tree connector line */}
                  <div className="absolute -left-2 top-0 bottom-0 w-px bg-border" />
                  
                  <Icon className={cn("h-4 w-4 shrink-0", ai.color)} />
                  <span className="flex-1 text-sm truncate">
                    {ai.displayName}
                  </span>
                </div>
              );
            })}
          </div>
        ))}
      </div>
    </ScrollArea>
  </div>
);
```

---

### –ß–∞—Å—Ç—å 5: Resizable –ø–∞–Ω–µ–ª—å

–û–±–Ω–æ–≤–∏—Ç—å `ExpertPanel.tsx` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `ResizablePanelGroup`:

```tsx
import { 
  ResizablePanelGroup, 
  ResizablePanel, 
  ResizableHandle 
} from '@/components/ui/resizable';

// –í return:
<div className="h-[calc(100vh-4rem)] flex overflow-hidden">
  <ResizablePanelGroup direction="horizontal">
    {/* Navigation Panel - resizable */}
    <ResizablePanel 
      defaultSize={20} 
      minSize={15} 
      maxSize={35}
      className="bg-sidebar"
    >
      <ChatTreeNav
        messages={messages}
        perModelSettings={perModelSettings}
        userDisplayInfo={userDisplayInfo}
        onMessageClick={handleMessageClick}
        activeParticipant={activeParticipant}
      />
    </ResizablePanel>

    <ResizableHandle withHandle />

    {/* Main Content */}
    <ResizablePanel defaultSize={80}>
      <div className="flex-1 flex flex-col min-w-0 h-full">
        {/* ... existing content ... */}
      </div>
    </ResizablePanel>
  </ResizablePanelGroup>
</div>
```

---

### –ß–∞—Å—Ç—å 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ callback

–ò–∑–º–µ–Ω–∏—Ç—å `onParticipantClick` –Ω–∞ `onMessageClick` –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é:

```typescript
// –í ChatTreeNavProps:
onMessageClick: (messageId: string) => void;

// –í ExpertPanel:
const handleMessageClick = (messageId: string) => {
  setActiveParticipant(messageId);
  
  messageRefs.current.get(messageId)?.scrollIntoView({
    behavior: 'smooth',
    block: 'center',
  });
};
```

---

### –ß–∞—Å—Ç—å 7: –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

–î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –∫–ª—é—á–∏:

```typescript
'chat.queryPreview': { ru: '–ó–∞–ø—Ä–æ—Å', en: 'Query' },
```

---

### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

| –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ |
|------|----------|
| `src/components/warroom/ChatTreeNav.tsx` | –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã |
| `src/pages/ExpertPanel.tsx` | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ResizablePanelGroup |

---

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

1. **–•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**:
   - –°—É–ø–µ—Ä–≤–∏–∑–æ—Ä #1 (—Å preview –∑–∞–ø—Ä–æ—Å–∞ –≤ tooltip)
     - –ö—Ä–∏—Ç–∏–∫ GPT-5
     - –≠–∫—Å–ø–µ—Ä—Ç Claude
   - –°—É–ø–µ—Ä–≤–∏–∑–æ—Ä #2
     - –≠–∫—Å–ø–µ—Ä—Ç Claude
     - –ö—Ä–∏—Ç–∏–∫ GPT-5
   - –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç-–º–∞—Ç–µ–º–∞—Ç–∏–∫ (standalone)
   - –ò —Ç.–¥.

2. **Resizable –ø–∞–Ω–µ–ª—å**:
   - –®–∏—Ä–∏–Ω–∞ –æ—Ç 15% –¥–æ 35%
   - –†—É—á–∫–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –ø—Ä–∏ resize –æ–∫–Ω–∞

3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è**:
   - –ö–ª–∏–∫ –ø–æ –ª—é–±–æ–º—É —É–∑–ª—É —Å–∫—Ä–æ–ª–ª–∏—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
   - Tooltip —Å –Ω–∞—á–∞–ª–æ–º –∑–∞–ø—Ä–æ—Å–∞ —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä–∞

