# Роль «Патентовед» (Patent Attorney) — Детальный план

> Категория: **Юридическая (Legal)** · Фаза 3  
> Статус: Проектирование  
> Дата: 2026-02-23

---

## 1. Концепция

Патентовед — штатная роль, анализирующая решения пользователя на патентоспособность. Работает в трёх режимах:

| Режим | Описание |
|-------|----------|
| **Патентный поиск** | Выделяет новизну (алгоритмы, архитектуру, комбинации), формирует запросы к патентным базам, ищет prior art через Firecrawl/Webhunter |
| **Составление заявки** | Генерирует формулу изобретения (claims), описание по стандартам PCT/РФ (область техники, уровень техники, раскрытие, примеры) |
| **Юридическая консультация** | Разъясняет результаты поиска и заявки простым языком, переводит claims, рекомендует стратегию, отвечает на «а что если» |

---

## 2. Архитектура

```
┌─────────────────────────────────────────────┐
│               Штат (StaffRoles)             │
│  ┌────────────────────────────────────────┐  │
│  │  Юридический отдел (Legal)            │  │
│  │  ┌──────────────────────────────────┐  │  │
│  │  │  patent_attorney                 │  │  │
│  │  │  ├─ Системный промпт             │  │  │
│  │  │  ├─ База знаний (role_knowledge) │  │  │
│  │  │  ├─ Критерии собеседования       │  │  │
│  │  │  └─ Инструменты (tools)          │  │  │
│  │  └──────────────────────────────────┘  │  │
│  └────────────────────────────────────────┘  │
└─────────────────────────────────────────────┘
```

### 2.1 Определение роли (`src/config/roles.ts`)

```ts
patent_attorney: {
  id: 'patent_attorney',
  category: 'legal',           // новая категория
  name_ru: 'Патентовед',
  name_en: 'Patent Attorney',
  icon: 'Scale',               // lucide-react
  description_ru: 'Анализирует решения на патентоспособность, ищет prior art, составляет заявки',
  description_en: 'Analyzes solutions for patentability, searches prior art, drafts applications',
  defaultModel: null,          // назначается через собеседование
  systemPrompt: '...',         // см. секцию 3
  interviewCriteria: [...],    // см. секцию 4
}
```

### 2.2 Категория в UI

- Группа **«Юридический отдел»** в `StaffRoles` (аналогично ОТК)
- Иконка: `Scale` (весы правосудия)
- Цвет акцента: `hsl(45, 80%, 50%)` — золотой/янтарный

---

## 3. Системный промпт

```markdown
Ты — Патентовед (Patent Attorney) в системе AI-Hydra.

## Режим 1: Патентный поиск
1. Проанализируй описание решения пользователя
2. Выдели потенциально патентоспособные элементы:
   - Новые алгоритмы или их комбинации
   - Архитектурные решения
   - Методы обработки данных
   - Пользовательские интерфейсные решения
3. Сформулируй поисковые запросы для патентных баз
4. Используй инструмент `patent_search` для поиска prior art
5. Составь отчёт: найденные аналоги, отличия, оценка новизны

## Режим 2: Составление заявки (PCT/РФ)
Структура документа:
1. **Область техники** — к какой области относится изобретение
2. **Уровень техники** — известные аналоги и их недостатки
3. **Раскрытие изобретения** — суть технического решения
4. **Формула изобретения** — независимые и зависимые пункты
5. **Описание чертежей** — при наличии схем/диаграмм
6. **Осуществление изобретения** — примеры реализации

## Режим 3: Юридическая консультация
Ты выступаешь как агент-консультант по ИС:
1. Разъясняй результаты патентного поиска простым языком
2. Объясняй почему конкретный аналог представляет риск или нет
3. Переводи формулировки claims на понятный неспециалисту язык
4. Рекомендуй следующие шаги (расширить/сузить формулу, юрисдикция, стратегия)
5. Отвечай на «а что если...» сценарии пользователя
6. Оценивай коммерческие и правовые риски патентования

## Ограничения
- Ты НЕ заменяешь патентного поверенного
- Всегда указывай, что результат требует проверки специалистом
- Используй формальный юридический стиль
```

---

## 4. Критерии собеседования

| # | Критерий | Вес | Описание |
|---|----------|-----|----------|
| 1 | Юридическая точность | 0.25 | Корректность терминологии, формулировок claims |
| 2 | Аналитическая глубина | 0.20 | Способность выделять патентоспособные элементы |
| 3 | Знание стандартов | 0.20 | PCT, ГК РФ ч.4, правила ФИПС/USPTO |
| 4 | Структурированность | 0.15 | Соответствие формату патентной заявки |
| 5 | Поиск аналогов | 0.10 | Качество формирования поисковых запросов |
| 6 | Коммуникация | 0.10 | Ясность объяснений для неспециалиста |

---

## 5. Инструменты (Tools)

### 5.1 `patent_search` — Поиск prior art

```ts
{
  name: 'patent_search',
  display_name: 'Патентный поиск',
  tool_type: 'http_api',
  description: 'Поиск патентных аналогов через Google Patents / Espacenet',
  parameters: [
    { name: 'query', type: 'string', description: 'Поисковый запрос', required: true },
    { name: 'jurisdiction', type: 'string', description: 'RU, US, EP, WO', required: false },
    { name: 'date_from', type: 'string', description: 'Дата начала поиска (YYYY)', required: false },
  ],
  http_config: {
    // Вариант A: Через Firecrawl scrape Google Patents
    url: 'https://patents.google.com/?q=${query}&country=${jurisdiction}',
    method: 'GET',
    // Вариант B: Через edge-функцию patent-search (рекомендуется)
  }
}
```

### 5.2 `draft_claims` — Генерация формулы изобретения

```ts
{
  name: 'draft_claims',
  display_name: 'Генерация формулы',
  tool_type: 'prompt',
  description: 'Составление формулы изобретения по описанию',
  prompt_template: `На основе описания: {{description}}
Составь формулу изобретения:
1. Независимый пункт (самый широкий объём прав)
2. 2-3 зависимых пункта (конкретизация)
Формат: стандарт PCT / ФИПС`,
  parameters: [
    { name: 'description', type: 'string', description: 'Описание изобретения', required: true },
    { name: 'standard', type: 'string', description: 'PCT или FIPS', required: false },
  ],
}
```

---

## 6. База знаний (Knowledge Base)

Категории для `role_knowledge`:

| Категория | Содержание | Источники |
|-----------|------------|-----------|
| `patent_law_rf` | ГК РФ ч.4, правила ФИПС | Консультант+, ФИПС |
| `patent_law_pct` | Правила PCT, формат заявки | WIPO |
| `patent_law_us` | USPTO guidelines | USPTO.gov |
| `claim_templates` | Шаблоны формул по типам (устройство, способ, система) | Практика |
| `search_strategies` | Стратегии патентного поиска, операторы CPC/IPC | Методические рекомендации |
| `ai_patents` | Патенты в области ИИ, прецеденты | Google Patents |

### Импорт знаний

Через существующий механизм Firecrawl → chunking → role_knowledge:
- ФИПС: `https://fips.ru/`
- WIPO PCT: `https://www.wipo.int/pct/en/`
- Google Patents: `https://patents.google.com/`

---

## 7. Интеграции

### 7.1 Firecrawl (существующая)
- Скрейпинг патентных баз (Google Patents, Espacenet)
- Парсинг полнотекстовых патентных документов
- Импорт нормативных актов в базу знаний

### 7.2 Edge-функция `patent-search` (новая)

```
POST /patent-search
{
  "query": "multi-agent AI system self-evolution",
  "sources": ["google_patents", "espacenet"],
  "jurisdiction": "WO",
  "limit": 20
}
```

Логика:
1. Формирует URL для Google Patents / Espacenet
2. Через Firecrawl scrape получает результаты
3. Парсит: номер патента, заявитель, дата, abstract
4. Возвращает структурированный список аналогов

### 7.3 Hydra-orchestrator

Добавление в `tools.ts`:
- Регистрация `patent_search` как built-in tool для роли `patent_attorney`
- Обработка результатов в формате ToolResult

---

## 8. Этапы реализации

### Этап 1: Фундамент ✅
- [x] Определение роли в `roles.ts` с категорией `legal`
- [x] Добавление группы «Юридический отдел» в UI StaffRoles
- [x] Системный промпт (два режима)
- [x] Критерии собеседования + плагин `patentAttorneyPlugin`

### Этап 2: Инструменты ✅
- [x] Edge-функция `patent-search` (Firecrawl → Google Patents)
- [x] Built-in tool `patent_search` в orchestrator (tool definition + executor)
- [x] `patent_attorney` добавлен в TECHNICAL_ROLES для auto-RAG
- [x] Тип `PatentSearchArgs` в types.ts

### Этап 3: База знаний ✅
- [x] Патентное право РФ (ГК РФ ч.4, объекты, структура заявки)
- [x] Международная система PCT (фазы, сроки, преимущества)
- [x] Шаблоны формул изобретений (способ, система, CII)
- [x] Стратегии патентного поиска (источники, классификации, операторы)
- [x] Патентование ИИ-решений (подходы РФ, USPTO, EPO)
- [x] Формат описания изобретения (ФИПС / PCT)

### Этап 4: Тестирование и собеседование (1 день)
- [ ] Тестовое собеседование кандидатов на роль
- [ ] Проверка режима патентного поиска
- [ ] Проверка режима составления заявки
- [ ] Запись в Хроники (EVO-006)

---

## 9. Зависимости

| Компонент | Статус | Примечание |
|-----------|--------|------------|
| Firecrawl API | ✅ Готов | Существующая интеграция |
| roles.ts | ✅ Готов | Добавить категорию `legal` |
| StaffRoles UI | ✅ Готов | Добавить группу |
| Interview system | ✅ Готов | Стандартный пайплайн |
| role_knowledge | ✅ Готов | Стандартная таблица |
| patent-search EF | ❌ Новое | Edge-функция |
| Webhunter | ⏳ Опционально | Альтернативный провайдер поиска |

---

## 10. Риски и митигация

| Риск | Вероятность | Митигация |
|------|-------------|-----------|
| Блокировка scraping патентных баз | Средняя | Ротация User-Agent, rate limiting, кэширование |
| Низкое качество генерации claims | Средняя | Шаблоны + few-shot примеры в knowledge base |
| Юридическая ответственность | Высокая | Дисклеймер: «не заменяет патентного поверенного» |
| Ограничения Firecrawl на динамические страницы | Низкая | `waitFor` параметр, fallback на Webhunter |
